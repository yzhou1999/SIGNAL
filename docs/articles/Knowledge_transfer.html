<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SIGNAL">
<title>Knowledge transfer from reference to query using SIGNAL â€¢ SIGNAL</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Knowledge transfer from reference to query using SIGNAL">
<meta property="og:description" content="SIGNAL">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SIGNAL</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Knowledge_transfer.html">Knowledge transfer from reference to query using SIGNAL</a>
    <a class="dropdown-item" href="../articles/Multiscale_analysis.html">Multi-scale analysis by multiple group variables</a>
    <a class="dropdown-item" href="../articles/Supervised_integration.html">Supervised integration using SIGNAL</a>
    <a class="dropdown-item" href="../articles/Unsupervised_integration.html">SIGNAL integration for unlabeled datasets</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/yzhou1999/SIGNAL/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Knowledge transfer from reference to query using SIGNAL</h1>
                        <h4 data-toc-skip class="author">Yang Zhou</h4>
            
            <h4 data-toc-skip class="date">2024-06-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/yzhou1999/SIGNAL/blob/HEAD/vignettes/Knowledge_transfer.Rmd" class="external-link"><code>vignettes/Knowledge_transfer.Rmd</code></a></small>
      <div class="d-none name"><code>Knowledge_transfer.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>SIGNAL allows knowledge transfer form reference data to query data,
containing two tasks: reference-based annotation and reference-based
integration. The latter integrates data based on the labels predicted by
the former. In this vignette, we use two human cortex scRNA-seq datasets
(<a href="https://doi.org/10.1101/2022.09.20.508736" class="external-link">human MTG</a> and
<a href="https://www.science.org/doi/10.1126/science.adf2359" class="external-link">human
cortex</a> datasets) to demonstrate how to perform these two tasks with
SIGNAL. We use the human MTG as the reference and the human cortex as
the query. We removed some cell type from reference to test label
annotation and integration scenarios with novel cell types in query
data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yzhou1999/SIGNAL" class="external-link">SIGNAL</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">irlba</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jlmelville/uwot" class="external-link">uwot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">randomcoloR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p>We identify HVGs from reference and read the expression matrix after
reference and query have been normalized and subset by HVGs. Among them,
2000 genes in query overlapped with identified HVGs. We represent the
missing gene in query as 0.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"/home/server/zy/group_scripts/datasets_preparation/Human_MTG/X.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ref_meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"/home/server/zy/group_scripts/datasets_preparation/Human_MTG/meta.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Batch"</span>, <span class="st">"SubClass"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">ref_meta</span><span class="op">$</span><span class="va">Dataset</span> <span class="op">=</span> <span class="st">"reference"</span></span>
<span><span class="va">ref_meta</span> <span class="op">=</span> <span class="va">ref_meta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">ref_meta</span><span class="op">$</span><span class="va">SubClass</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sst Chodl"</span>, <span class="st">"L5 ET"</span>, <span class="st">"Endothelial"</span>, <span class="st">"L4 IT"</span>, <span class="st">"Oligodendrocyte"</span>, <span class="st">"L2/3 IT"</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">ref_X</span> <span class="op">=</span> <span class="va">ref_X</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ref_meta</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">query_X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/home/server/zy/group_scripts/datasets_preparation/Human_cortex/new_X.rds"</span><span class="op">)</span></span>
<span><span class="va">query_meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/home/server/zy/group_scripts/datasets_preparation/Human_cortex/meta.rds"</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Batch"</span>, <span class="st">"SubClass"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">query_meta</span><span class="op">$</span><span class="va">Dataset</span> <span class="op">=</span> <span class="st">"query"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ref_X</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'dgCMatrix' [package "Matrix"] with 6 slots</span></span>
<span><span class="co">##   ..@ i       : int [1:47935347] 17 42 44 59 82 87 91 100 104 106 ...</span></span>
<span><span class="co">##   ..@ p       : int [1:85652] 0 540 1177 1961 2453 2940 3427 3969 4793 5192 ...</span></span>
<span><span class="co">##   ..@ Dim     : int [1:2] 4000 85651</span></span>
<span><span class="co">##   ..@ Dimnames:List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:4000] "MIR1302-2HG" "LINC02593" "SAMD11" "TMEM88B" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:85651] "AAACCCAAGTGATCGG-L8TX_191029_01_A07-1156636564" "AAACCCACAGGACTTT-L8TX_191029_01_A07-1156636564" "AAACCCAGTCTCGGAC-L8TX_191029_01_A07-1156636564" "AAACCCAGTTCTCGCT-L8TX_191029_01_A07-1156636564" ...</span></span>
<span><span class="co">##   ..@ x       : num [1:47935347] 3.445 0.446 0.753 1.89 0.446 ...</span></span>
<span><span class="co">##   ..@ factors : list()</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ref_meta</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    85651 obs. of  3 variables:</span></span>
<span><span class="co">##  $ Batch   : chr  "Donor1" "Donor1" "Donor1" "Donor1" ...</span></span>
<span><span class="co">##  $ SubClass: chr  "Sst" "L5 IT" "L5 IT" "L5 IT" ...</span></span>
<span><span class="co">##  $ Dataset : chr  "reference" "reference" "reference" "reference" ...</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">query_X</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'dgCMatrix' [package "Matrix"] with 6 slots</span></span>
<span><span class="co">##   ..@ i       : int [1:173988543] 11 46 48 61 63 69 70 71 72 77 ...</span></span>
<span><span class="co">##   ..@ p       : int [1:379331] 0 354 792 1312 1726 2177 2699 3095 3549 4008 ...</span></span>
<span><span class="co">##   ..@ Dim     : int [1:2] 2269 379330</span></span>
<span><span class="co">##   ..@ Dimnames:List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:2269] "SAMD11" "TMEM88B" "VWA1" "HES5" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:379330] "AAACCCAAGAGAGGTA-L8TX_190416_01_C06-871132075" "AAACGAAGTTGACGGA-L8TX_190416_01_C06-871132075" "AAACGAATCTCAAAGC-L8TX_190416_01_C06-871132075" "AAACGCTGTACTCGCG-L8TX_190416_01_C06-871132075" ...</span></span>
<span><span class="co">##   ..@ x       : num [1:173988543] 1.83 0.84 0.84 1.29 0.84 ...</span></span>
<span><span class="co">##   ..@ factors : list()</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">query_meta</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    379330 obs. of  3 variables:</span></span>
<span><span class="co">##  $ Batch   : chr  "H17.26.003" "H17.26.003" "H17.26.003" "H17.26.003" ...</span></span>
<span><span class="co">##  $ SubClass: chr  "L2/3 IT" "L2/3 IT" "L2/3 IT" "L2/3 IT" ...</span></span>
<span><span class="co">##  $ Dataset : chr  "query" "query" "query" "query" ...</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zero_m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html" class="external-link">sparseMatrix</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ref_X</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">query_X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">query_X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">zero_m</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ref_X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">query_X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">zero_m</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">query_X</span><span class="op">)</span></span>
<span><span class="va">query_X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">query_X</span>, <span class="va">zero_m</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ref_X</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualization-of-raw-data">Visualization of raw data<a class="anchor" aria-label="anchor" href="#visualization-of-raw-data"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/randomcoloR/man/distinctColorPalette.html" class="external-link">distinctColorPalette</a></span><span class="op">(</span><span class="fl">24</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ref_X</span>, <span class="va">query_X</span><span class="op">)</span></span>
<span><span class="va">meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind.data.frame</a></span><span class="op">(</span><span class="va">ref_meta</span>, <span class="va">query_meta</span><span class="op">)</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">raw_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">raw_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">raw_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">raw_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">raw_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">raw_umap</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">raw_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Dataset"</span>, palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#196534"</span>, <span class="st">"#9ED089"</span><span class="op">)</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">raw_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"SubClass"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Knowledge_transfer_files/figure-html/unnamed-chunk-3-1.png" width="1248"></p>
</div>
<div class="section level2">
<h2 id="label-prediction-and-reference-based-integration">Label prediction and reference-based integration<a class="anchor" aria-label="anchor" href="#label-prediction-and-reference-based-integration"></a>
</h2>
<p>We check whether SIGNAL can distinguish between cell types removed
from reference.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted_labels</span> <span class="op">=</span> <span class="fu"><a href="../reference/Run.LabelTransfer.Single.html">Run.LabelTransfer.Single</a></span><span class="op">(</span><span class="va">ref_X</span>, <span class="va">ref_meta</span><span class="op">$</span><span class="va">SubClass</span>, <span class="va">query_X</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">predicted_labels</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    379330 obs. of  2 variables:</span></span>
<span><span class="co">##  $ Prediction: chr  "L6 IT" "L6 IT" "L5 IT" "L6 IT" ...</span></span>
<span><span class="co">##  $ Confidence: num  0.517 0.595 0.571 0.497 0.581 ...</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span><span class="op">$</span><span class="va">Prediction</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ref_meta</span><span class="op">$</span><span class="va">SubClass</span>, <span class="va">predicted_labels</span><span class="op">$</span><span class="va">Prediction</span><span class="op">)</span></span>
<span><span class="va">meta</span><span class="op">$</span><span class="va">Confidence</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ref_meta</span><span class="op">)</span><span class="op">)</span>, <span class="va">predicted_labels</span><span class="op">$</span><span class="va">Confidence</span><span class="op">)</span></span>
<span><span class="va">signal_emb</span> <span class="op">=</span> <span class="fu"><a href="../reference/Run.gcPCA.html">Run.gcPCA</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">meta</span>, g_factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prediction"</span>, <span class="st">"Dataset"</span><span class="op">)</span>, b_factor <span class="op">=</span> <span class="st">"Batch"</span>,</span>
<span>                       excluded.cells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">meta</span><span class="op">$</span><span class="va">Dataset</span><span class="op">==</span> <span class="st">'query'</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">predicted_labels</span><span class="op">$</span><span class="va">Confidence</span> <span class="op">&lt;</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Run gcPCA!</span></span></code></pre>
<pre><code><span><span class="co">## gcPCA done!</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">signal_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">signal_emb</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">signal_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">signal_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">signal_umap</span><span class="op">)</span></span>
<span><span class="va">q1</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">signal_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Dataset"</span>, palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#196534"</span>, <span class="st">"#9ED089"</span><span class="op">)</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q2</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">signal_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"SubClass"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q3</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">signal_umap</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">meta</span><span class="op">$</span><span class="va">Dataset</span> <span class="op">==</span> <span class="st">"query"</span><span class="op">)</span>,<span class="op">]</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Confidence"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/gradient_color.html" class="external-link">gradient_color</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,  <span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">q1</span>, <span class="va">q2</span>, <span class="va">q3</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Knowledge_transfer_files/figure-html/unnamed-chunk-4-1.png" width="1248"></p>
<details><summary><strong>Session Info</strong>
</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.3 (2023-03-15)</span></span>
<span><span class="co">## Platform: x86_64-conda-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS/LAPACK: /home/server/anaconda3/envs/zy/lib/libopenblasp-r0.3.21.so</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] cowplot_1.1.1       randomcoloR_1.1.0.1 ggpubr_0.6.0       </span></span>
<span><span class="co">## [4] ggplot2_3.4.4       uwot_0.2.2          irlba_2.3.5.1      </span></span>
<span><span class="co">## [7] Matrix_1.5-4.1      SIGNAL_1.0.0       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] matrixStats_1.0.0        fs_1.6.4                 flock_0.7               </span></span>
<span><span class="co">##  [4] RcppAnnoy_0.0.22         doParallel_1.0.17        tools_4.2.3             </span></span>
<span><span class="co">##  [7] backports_1.4.1          bslib_0.7.0              utf8_1.2.4              </span></span>
<span><span class="co">## [10] R6_2.5.1                 BiocGenerics_0.44.0      colorspace_2.1-0        </span></span>
<span><span class="co">## [13] withr_3.0.0              tidyselect_1.2.1         bit_4.0.5               </span></span>
<span><span class="co">## [16] curl_5.2.1               compiler_4.2.3           bigparallelr_0.3.2      </span></span>
<span><span class="co">## [19] textshaping_0.3.7        cli_3.6.2                BiocNeighbors_1.16.0    </span></span>
<span><span class="co">## [22] desc_1.4.3               labeling_0.4.3           sass_0.4.9              </span></span>
<span><span class="co">## [25] scales_1.3.0             pkgdown_2.0.7            systemfonts_1.0.6       </span></span>
<span><span class="co">## [28] stringr_1.5.1            digest_0.6.35            rmarkdown_2.26          </span></span>
<span><span class="co">## [31] pkgconfig_2.0.3          htmltools_0.5.8.1        sparseMatrixStats_1.10.0</span></span>
<span><span class="co">## [34] MatrixGenerics_1.10.0    fastmap_1.1.1            highr_0.10              </span></span>
<span><span class="co">## [37] rlang_1.1.3              rstudioapi_0.15.0        jquerylib_0.1.4         </span></span>
<span><span class="co">## [40] generics_0.1.3           farver_2.1.1             jsonlite_1.8.8          </span></span>
<span><span class="co">## [43] mclust_6.0.0             BiocParallel_1.32.6      dplyr_1.1.4             </span></span>
<span><span class="co">## [46] car_3.1-2                magrittr_2.0.3           Rcpp_1.0.12             </span></span>
<span><span class="co">## [49] munsell_0.5.1            S4Vectors_0.36.2         fansi_1.0.6             </span></span>
<span><span class="co">## [52] abind_1.4-5              lifecycle_1.0.4          stringi_1.8.3           </span></span>
<span><span class="co">## [55] yaml_2.3.8               carData_3.0-5            Rtsne_0.17              </span></span>
<span><span class="co">## [58] grid_4.2.3               parallel_4.2.3           lattice_0.21-8          </span></span>
<span><span class="co">## [61] knitr_1.46               ps_1.7.6                 pillar_1.9.0            </span></span>
<span><span class="co">## [64] ggsignif_0.6.4           bigstatsr_1.5.12         codetools_0.2-19        </span></span>
<span><span class="co">## [67] stats4_4.2.3             bigassertr_0.1.6         glue_1.7.0              </span></span>
<span><span class="co">## [70] evaluate_0.23            V8_4.4.2                 vctrs_0.6.5             </span></span>
<span><span class="co">## [73] foreach_1.5.2            gtable_0.3.5             purrr_1.0.2             </span></span>
<span><span class="co">## [76] tidyr_1.3.1              cachem_1.0.8             xfun_0.43               </span></span>
<span><span class="co">## [79] broom_1.0.5              RcppEigen_0.3.4.0.0      ff_4.0.12               </span></span>
<span><span class="co">## [82] RSpectra_0.16-1          rstatix_0.7.2            ragg_1.2.7              </span></span>
<span><span class="co">## [85] tibble_3.2.1             iterators_1.0.14         memoise_2.0.1           </span></span>
<span><span class="co">## [88] cluster_2.1.4            rmio_0.4.0</span></span></code></pre>
</details>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Yang Zhou.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
